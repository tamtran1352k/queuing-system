<!DOCTYPE html>
<html>
<head>
  <title>Biểu đồ và bảng thống kê theo tuần và tháng</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
</head>
<body>
  <input type="text" id="datePicker" placeholder="Chọn ngày">
  <button id="showChartButton">Hiển thị</button>
  <canvas id="chartCanvas"></canvas>
  <table id="dataTable">
    <thead>
      <tr>
        <th>Thời gian</th>
        <th>Tổng giá trị</th>
      </tr>
    </thead>
    <tbody>
      <!-- Các dòng sẽ được thêm vào bảng sau khi tính toán -->
    </tbody>
  </table>

  <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.1/moment.min.js"></script>
  <script>
    // Dữ liệu ví dụ
    const data = [
      { date: '2023-07-01', value: 10 },
      { date: '2023-07-02', value: 15 },
      { date: '2023-07-03', value: 5 },
      { date: '2023-07-04', value: 20 },
      { date: '2023-07-05', value: 12 },
      // Thêm dữ liệu cho các ngày khác (nếu cần)
    ];

    // Khởi tạo DatePicker
    const datePicker = flatpickr("#datePicker", {
      mode: "range",
      dateFormat: "Y-m-d",
      onChange: function(selectedDates) {
        updateTableData();
      }
    });

    // Khởi tạo sự kiện click cho nút Hiển thị
    const showChartButton = document.getElementById("showChartButton");
    showChartButton.addEventListener("click", function() {
      updateChartData();
    });

    // Cập nhật dữ liệu biểu đồ
    function updateChartData() {
      const selectedDates = datePicker.selectedDates;
      const filteredData = getFilteredData(selectedDates);

      const dates = filteredData.map(item => item.date);
      const values = filteredData.map(item => item.value);

      const chartCanvas = document.getElementById('chartCanvas');
      const chartContext = chartCanvas.getContext('2d');

      new Chart(chartContext, {
        type: 'line',
        data: {
          labels: dates,
          datasets: [
            {
              label: 'Giá trị',
              data: values,
              fill: false,
              borderColor: 'rgba(33, 150, 243, 1)',
              tension: 0.1,
            },
          ],
        },
        options: {
          responsive: true,
        },
      });
    }

    // Cập nhật dữ liệu bảng
    function updateTableData() {
      const selectedDates = datePicker.selectedDates;
      const filteredData = getFilteredData(selectedDates);

      const dataTable = document.getElementById('dataTable');
      const tbody = dataTable.querySelector('tbody');
      tbody.innerHTML = '';

      filteredData.forEach(item => {
        const row = document.createElement('tr');
        const dateCell = document.createElement('td');
        dateCell.textContent = item.date;
        const valueCell = document.createElement('td');
        valueCell.textContent = item.value;
        row.appendChild(dateCell);
        row.appendChild(valueCell);
        tbody.appendChild(row);
      });
    }

    // Lấy dữ liệu được lọc theo khoảng thời gian
    function getFilteredData(selectedDates) {
      const startDate = moment(selectedDates[0]);
      const endDate = moment(selectedDates[1]);
      const filteredData = data.filter(item => {
        const date = moment(item.date);
        return date.isSameOrAfter(startDate, 'day') && date.isSameOrBefore(endDate, 'day');
      });
      return filteredData;
    }
  </script>
</body>
</html>
